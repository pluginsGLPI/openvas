<?php
/* @version $Id$
--------------------------------------------------------------------------
LICENSE

 This file is part of the openvas plugin.

OpenVAS plugin is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

openvas plugin is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with GLPI; along with openvas. If not, see <http://www.gnu.org/licenses/>.
--------------------------------------------------------------------------
@package   openvas
@author    Teclib'
@copyright Copyright (c) 2016 Teclib'
@license   GPLv3
           http://www.gnu.org/licenses/gpl.txt
@link      https://github.com/pluginsGLPI/openvas
@link      http://www.glpi-project.org/
@link      http://www.teclib-edition.com/
@since     2016
----------------------------------------------------------------------*/

/** @file
* @brief
*/
if (!defined('GLPI_ROOT')) {
   die("Sorry. You can't access this file directly");
}

/// OCS Rules class
class PluginOpenvasRuleVulnerability extends Rule {

   public $can_sort          = true;
   static $rightname         = 'plugin_openvas_vulnerability';

   function getTitle() {
      return __('Rules for OpenVAS vulnerabilities', 'openvas');
   }


   /**
   * @see Rule::maxActionsCount()
   **/
   function maxActionsCount() {
      // Unlimited
      return 2;
   }


   function getCriterias() {

      static $criterias = [];

      if (count($criterias)) {
         return $criterias;
      }

      $criterias['name']['table'] = 'glpi_plugin_openvas_vulnerabilities';
      $criterias['name']['field'] = 'name';
      $criterias['name']['name']  = __('Name');

      $criterias['comment']['table'] = 'glpi_plugin_openvas_vulnerabilities';
      $criterias['comment']['field'] = 'comment';
      $criterias['comment']['name']  = __('Comments');

      $criterias['threat']['name']   = __('Threat', 'openvas');
      $criterias['severity']['name']   = __('Severity', 'openvas');

      $criterias['port']['table'] = 'glpi_plugin_openvas_vulnerabilities';
      $criterias['port']['field'] = 'port';
      $criterias['port']['name']  = __('Port');

      $criterias['openvas_host']['table'] = 'glpi_plugin_openvas_configs';
      $criterias['openvas_host']['field'] = 'openvas_host';
      $criterias['openvas_host']['name']  = __('Serveur Openvas');


      return $criterias;
   }

   function getActions() {

      $actions['_ignore_import']['name'] = __('To be unaware of import');
      $actions['_ignore_import']['type'] = 'yesonly';

      $actions['_create_ticket']['name'] = __('Create a new ticket using a template', 'openvas');
      $actions['_create_ticket']['type'] = 'dropdown';
      $actions['_create_ticket']['table'] = 'glpi_tickettemplates';

      $actions['category']['name'] = __('Vulnerability category', 'openvas');
      $actions['category']['type'] = 'dropdown';
      $actions['category']['table'] = 'glpi_plugin_openvas_vulnerabilitycategories';

      $actions['entities_id']['table'] = 'glpi_entities';
      $actions['entities_id']['name']  = __('Entity');
      $actions['entities_id']['type']      = 'dropdown';

      return $actions;

   }
}
